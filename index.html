<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œêµ­ì–´ â†’ ì¼ë³¸ì–´ ë²ˆì—­ê¸°</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 20px auto; padding: 0 20px; }
        textarea { width: 100%; height: 100px; margin-bottom: 10px; padding: 10px; box-sizing: border-box; }
        button { padding: 10px 15px; margin: 5px 5px 5px 0; cursor: pointer; }
        #output { margin-top: 20px; padding: 15px; background-color: #f4f4f4; border-radius: 5px; min-height: 50px; }
        .time-log { font-size: 0.85em; color: #555; margin-top: 10px; }
        #history { margin-top: 30px; border-top: 1px solid #ccc; padding-top: 10px; }
        .history-item { padding: 8px 0; border-bottom: 1px dashed #eee; font-size: 0.9em; }
    </style>
</head>
<body>
    <h2>ì´ˆê²½ëŸ‰ í•œì¼ ë²ˆì—­ê¸° (í•œêµ­ì–´ â†’ ì¼ë³¸ì–´)</h2>
    
    <textarea id="inputText" placeholder="í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ í•˜ë‹¨ì˜ ìŒì„± ë²„íŠ¼ì„ ëˆ„ë¥´ì‹­ì‹œì˜¤."></textarea>
    
    <div>
        <button onclick="translateText('KO', 'JA')">í…ìŠ¤íŠ¸ ë²ˆì—­ (í•œ â†’ ì¼)</button>
    </div>
    <div style="margin-top: 10px;">
        <button onclick="startSpeechRecognition('ko-KR', 'KO', 'JA')">ğŸ¤ í•œêµ­ì–´ ìŒì„± ë²ˆì—­</button>
    </div>

    <div id="output">ê²°ê³¼ ëŒ€ê¸° ì¤‘...</div>

    <div id="history">
        <h3>ìµœê·¼ ë²ˆì—­ ì´ë ¥ (ìµœëŒ€ 10ê°œ)</h3>
        <div id="historyList"></div>
    </div>

    <script>
        // ë²ˆì—­ ì´ë ¥ ì €ì¥ìš© ë°°ì—´
        let translationHistory = [];

        function updateHistoryUI() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            translationHistory.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `<strong>[${item.time}ì´ˆ]</strong> ${item.original} â” ${item.translated}`;
                historyList.appendChild(div);
            });
        }

        function addHistory(original, translated, timeTaken) {
            // ë°°ì—´ì˜ ë§¨ ì•ì— ìƒˆ í•­ëª© ì¶”ê°€
            translationHistory.unshift({ original, translated, time: timeTaken });
            // 10ê°œë¥¼ ì´ˆê³¼í•˜ë©´ ë§ˆì§€ë§‰ í•­ëª© ì œê±°
            if (translationHistory.length > 10) {
                translationHistory.pop();
            }
            updateHistoryUI();
        }

        async function translateText(source, target, textToTranslate = null) {
            const text = textToTranslate || document.getElementById('inputText').value.trim();
            if (!text) return alert("ë²ˆì—­í•  í…ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.");

            const outputDiv = document.getElementById('output');
            outputDiv.innerHTML = "ë²ˆì—­ ì§„í–‰ ì¤‘...";

            const startTime = performance.now(); // íƒ€ì´ë¨¸ ì‹œì‘

            try {
                const response = await fetch('/translate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: text, source_lang: source, target_lang: target })
                });
                const data = await response.json();
                
                const endTime = performance.now(); // íƒ€ì´ë¨¸ ì¢…ë£Œ
                const timeTaken = ((endTime - startTime) / 1000).toFixed(2); // ì´ˆ ë‹¨ìœ„ ì†Œìˆ˜ì  ë‘˜ì§¸ ìë¦¬ê¹Œì§€ ê³„ì‚°

                if (response.ok) {
                    outputDiv.innerHTML = `${data.translated_text}<div class="time-log">ì†Œìš” ì‹œê°„: ${timeTaken}ì´ˆ</div>`;
                    addHistory(text, data.translated_text, timeTaken);
                } else {
                    outputDiv.innerText = "ì„œë²„ ì˜¤ë¥˜: " + data.detail;
                }
            } catch (error) {
                outputDiv.innerText = "í†µì‹  ì˜¤ë¥˜: " + error.message;
            }
        }

        function startSpeechRecognition(langCode, sourceLang, targetLang) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. Chrome, Edge ë“±ì„ ì‚¬ìš©í•˜ì‹­ì‹œì˜¤.");
                return;
            }

            const recognition = new SpeechRecognition();
            recognition.lang = langCode;
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            recognition.onstart = function() {
                document.getElementById('output').innerText = "ìŒì„± ì…ë ¥ ëŒ€ê¸° ì¤‘...";
            };

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                document.getElementById('inputText').value = transcript;
                translateText(sourceLang, targetLang, transcript);
            };

            recognition.onerror = function(event) {
                document.getElementById('output').innerText = "ìŒì„± ì¸ì‹ ì‹¤íŒ¨: " + event.error;
            };

            recognition.start();
        }
    </script>
</body>
</html>
