<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œì¼ ë²ˆì—­ê¸°</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 20px auto; padding: 0 20px; }
        
        /* íƒ­ UI ìŠ¤íƒ€ì¼ */
        .tabs { display: flex; margin-bottom: 20px; border-bottom: 2px solid #ccc; }
        .tab-button { flex: 1; padding: 10px; cursor: pointer; border: none; background: none; font-size: 16px; color: #555; }
        .tab-button.active { font-weight: bold; border-bottom: 2px solid #007bff; margin-bottom: -2px; color: #007bff; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        textarea { width: 100%; height: 100px; margin-bottom: 10px; padding: 10px; box-sizing: border-box; }
        button.action-btn { padding: 10px 15px; margin: 5px 5px 5px 0; cursor: pointer; }
        #output { margin-top: 20px; padding: 15px; background-color: #f4f4f4; border-radius: 5px; min-height: 50px; }
        .time-log { font-size: 0.85em; color: #555; margin-top: 10px; }
        
        /* ì´ë ¥ UI ìŠ¤íƒ€ì¼ */
        .history-item { padding: 10px 0; border-bottom: 1px dashed #eee; font-size: 0.95em; }
        .history-empty { color: #999; padding: 20px 0; text-align: center; }
    </style>
</head>
<body>
    <h2>ì´ˆê²½ëŸ‰ í•œì¼ ë²ˆì—­ê¸°</h2>

    <div class="tabs">
        <button class="tab-button active" onclick="switchTab(event, 'translateTab')">ë²ˆì—­ê¸°</button>
        <button class="tab-button" onclick="switchTab(event, 'historyTab')">ë²ˆì—­ ì´ë ¥</button>
    </div>

    <div id="translateTab" class="tab-content active">
        <textarea id="inputText" placeholder="í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ í•˜ë‹¨ì˜ ìŒì„± ë²„íŠ¼ì„ ëˆ„ë¥´ì‹­ì‹œì˜¤."></textarea>
        
        <div>
            <button class="action-btn" onclick="translateText('KO', 'JA')">í…ìŠ¤íŠ¸ ë²ˆì—­ (í•œ â†’ ì¼)</button>
        </div>
        <div style="margin-top: 10px;">
            <button class="action-btn" onclick="startSpeechRecognition('ko-KR', 'KO', 'JA')">ğŸ¤ í•œêµ­ì–´ ìŒì„± ë²ˆì—­ (í•œ â†’ ì¼)</button>
            <button class="action-btn" onclick="startSpeechRecognition('ja-JP', 'JA', 'KO')">ğŸ¤ ì¼ë³¸ì–´ ìŒì„± ë²ˆì—­ (ì¼ â†’ í•œ)</button>
        </div>

        <div id="output">ê²°ê³¼ ëŒ€ê¸° ì¤‘...</div>
    </div>

    <div id="historyTab" class="tab-content">
        <div id="historyList">
            <div class="history-empty">ê¸°ë¡ëœ ë²ˆì—­ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</div>
        </div>
    </div>

    <script>
        // íƒ­ ì „í™˜ ë¡œì§
        function switchTab(event, tabId) {
            // ëª¨ë“  íƒ­ ì½˜í…ì¸  ìˆ¨ê¹€
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));

            // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(button => button.classList.remove('active'));

            // ì„ íƒëœ íƒ­ê³¼ ë²„íŠ¼ í™œì„±í™”
            document.getElementById(tabId).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        // ë²ˆì—­ ì´ë ¥ ì €ì¥ìš© ë°°ì—´
        let translationHistory = [];

        function updateHistoryUI() {
            const historyList = document.getElementById('historyList');
            if (translationHistory.length === 0) {
                historyList.innerHTML = '<div class="history-empty">ê¸°ë¡ëœ ë²ˆì—­ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            historyList.innerHTML = '';
            translationHistory.forEach((item) => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `<strong>[${item.time}ì´ˆ]</strong> ${item.original} â” <strong>${item.translated}</strong>`;
                historyList.appendChild(div);
            });
        }

        function addHistory(original, translated, timeTaken) {
            translationHistory.unshift({ original, translated, time: timeTaken });
            if (translationHistory.length > 10) {
                translationHistory.pop();
            }
            updateHistoryUI();
        }

        async function translateText(source, target, textToTranslate = null) {
            const text = textToTranslate || document.getElementById('inputText').value.trim();
            if (!text) return alert("ë²ˆì—­í•  í…ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.");

            const outputDiv = document.getElementById('output');
            outputDiv.innerHTML = "ë²ˆì—­ ì§„í–‰ ì¤‘...";

            const startTime = performance.now();

            try {
                const response = await fetch('/translate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: text, source_lang: source, target_lang: target })
                });
                const data = await response.json();
                
                const endTime = performance.now();
                const timeTaken = ((endTime - startTime) / 1000).toFixed(2);

                if (response.ok) {
                    outputDiv.innerHTML = `${data.translated_text}<div class="time-log">ì†Œìš” ì‹œê°„: ${timeTaken}ì´ˆ</div>`;
                    addHistory(text, data.translated_text, timeTaken);
                } else {
                    outputDiv.innerText = "ì„œë²„ ì˜¤ë¥˜: " + data.detail;
                }
            } catch (error) {
                outputDiv.innerText = "í†µì‹  ì˜¤ë¥˜: " + error.message;
            }
        }

        function startSpeechRecognition(langCode, sourceLang, targetLang) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. Chrome, Edge ë“±ì„ ì‚¬ìš©í•˜ì‹­ì‹œì˜¤.");
                return;
            }

            const recognition = new SpeechRecognition();
            recognition.lang = langCode;
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            recognition.onstart = function() {
                document.getElementById('output').innerText = "ìŒì„± ì…ë ¥ ëŒ€ê¸° ì¤‘...";
            };

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                document.getElementById('inputText').value = transcript;
                translateText(sourceLang, targetLang, transcript);
            };

            recognition.onerror = function(event) {
                document.getElementById('output').innerText = "ìŒì„± ì¸ì‹ ì‹¤íŒ¨: " + event.error;
            };

            recognition.start();
        }
    </script>
</body>
</html>
