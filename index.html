<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œì¼ ë²ˆì—­ê¸°</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 20px auto; padding: 0 20px; }
        textarea { width: 100%; height: 100px; margin-bottom: 10px; padding: 10px; box-sizing: border-box; }
        button { padding: 10px 15px; margin: 5px 5px 5px 0; cursor: pointer; }
        #output { margin-top: 20px; padding: 15px; background-color: #f4f4f4; border-radius: 5px; min-height: 50px; }
    </style>
</head>
<body>
    <h2>ì´ˆê²½ëŸ‰ í•œì¼ ë²ˆì—­ê¸°</h2>
    
    <textarea id="inputText" placeholder="í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ í•˜ë‹¨ì˜ ìŒì„± ë²„íŠ¼ì„ ëˆ„ë¥´ì‹­ì‹œì˜¤."></textarea>
    
    <div>
        <button onclick="translateText('KO', 'JA')">í…ìŠ¤íŠ¸ ë²ˆì—­ (í•œ â†’ ì¼)</button>
        <button onclick="translateText('JA', 'KO')">í…ìŠ¤íŠ¸ ë²ˆì—­ (ì¼ â†’ í•œ)</button>
    </div>
    <div style="margin-top: 10px;">
        <button onclick="startSpeechRecognition('ko-KR', 'KO', 'JA')">ğŸ¤ í•œêµ­ì–´ ìŒì„± ë²ˆì—­</button>
        <button onclick="startSpeechRecognition('ja-JP', 'JA', 'KO')">ğŸ¤ ì¼ë³¸ì–´ ìŒì„± ë²ˆì—­</button>
    </div>

    <div id="output">ê²°ê³¼ ëŒ€ê¸° ì¤‘...</div>

    <script>
        // í…ìŠ¤íŠ¸ ë²ˆì—­ API í˜¸ì¶œ
        async function translateText(source, target, textToTranslate = null) {
            const text = textToTranslate || document.getElementById('inputText').value.trim();
            if (!text) return alert("ë²ˆì—­í•  í…ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.");

            const outputDiv = document.getElementById('output');
            outputDiv.innerText = "ë²ˆì—­ ì§„í–‰ ì¤‘...";

            try {
                const response = await fetch('/translate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: text, source_lang: source, target_lang: target })
                });
                const data = await response.json();
                
                if (response.ok) {
                    outputDiv.innerText = data.translated_text;
                } else {
                    outputDiv.innerText = "ì„œë²„ ì˜¤ë¥˜: " + data.detail;
                }
            } catch (error) {
                outputDiv.innerText = "í†µì‹  ì˜¤ë¥˜: " + error.message;
            }
        }

        // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ìŒì„± ì¸ì‹ (Web Speech API)
        function startSpeechRecognition(langCode, sourceLang, targetLang) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. Chrome Edge ë“±ì„ ì‚¬ìš©í•˜ì‹­ì‹œì˜¤.");
                return;
            }

            const recognition = new SpeechRecognition();
            recognition.lang = langCode;
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            recognition.onstart = function() {
                document.getElementById('output').innerText = "ìŒì„± ì…ë ¥ ëŒ€ê¸° ì¤‘...";
            };

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                document.getElementById('inputText').value = transcript;
                translateText(sourceLang, targetLang, transcript);
            };

            recognition.onerror = function(event) {
                document.getElementById('output').innerText = "ìŒì„± ì¸ì‹ ì‹¤íŒ¨: " + event.error;
            };

            recognition.start();
        }
    </script>
</body>
</html>